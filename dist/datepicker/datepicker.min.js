!function(){function t(t){return JSON.parse(JSON.stringify(t))}function e(t){if(0===t.getUTCHours()&&0===t.getUTCMinutes()&&0===t.getUTCSeconds()&&0===t.getUTCMilliseconds())return new Date(t.valueOf());var e=new Date;return e.setUTCDate(t.getDate()),e.setUTCMonth(t.getMonth()),e.setUTCFullYear(t.getFullYear()),e.setUTCHours(0),e.setUTCMinutes(0),e.setUTCSeconds(0),e.setUTCMilliseconds(0),e}function n(t){return t instanceof Date&&!!t.getTime&&!isNaN(t.getTime())}function r(t){return t.getUTCFullYear()}function i(t){return t.getUTCMonth()}function a(t){return t.getUTCDate()}function o(t,e){var n=t.toString(),r=new Array(e).join("0");return(r+n).substr(-e)}function s(t){return[o(r(t),4),o(i(t)+1,2),o(a(t),2)].join("-")}function u(t){if(n(t))return t;var r=g.exec(t);return r?e(new Date(r[1],r[2]-1,r[3])):null}function l(t){if(n(t))return t;var r=u(t);if(r)return r;var i=Date.parse(t);return isNaN(i)?null:e(new Date(i))}function c(t){var e=t.polyfill?t.xtag.polyfillInput:t.xtag.dateInput,n=l(e.value);return n?t.removeAttribute("invalid"):t.setAttribute("invalid",!0),!!n}function d(t,e){var n=t.polyfill?t.xtag.polyfillInput:t.xtag.dateInput,r=n.value,i=l(r);t.value=e&&i?i:r}function f(t,e,n){var r=t.submitValue,i=t.value;e();var a=t.submitValue,o=t.value;(r!==a||n&&i!==o)&&xtag.fireEvent(t,"change")}function h(t){var e=t.xtag._labels;return new Array(5).join(e.yearAbbr)+"-"+new Array(3).join(e.monthAbbr)+"-"+new Array(3).join(e.dayAbbr)}var p=13,v=document.createElement("x-calendar").labels,g=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/;xtag.register("x-datepicker",{lifecycle:{created:function(){this.innerHTML="";var e=document.createElement("input");e.setAttribute("type","date"),xtag.addClass(e,"x-datepicker-input"),this.appendChild(e),this.xtag.dateInput=e,this.xtag._labels={yearAbbr:"Y",monthAbbr:"M",dayAbbr:"D"},this.xtag._polyfillCalLabels=t(v),this.xtag.polyfillInput=null,this.xtag.polyfillUI=null,this.polyfill=this.hasAttribute("polyfill")||"date"!==e.type.toLowerCase()}},events:{"datetoggleon:delegate(x-calendar)":function(t){var e=t.currentTarget;if(t.detail&&t.detail.date){var n=l(t.detail.date);f(e,function(){e.value=n?s(n):"",xtag.fireEvent(e,"input")})}},"datetoggleoff:delegate(x-calendar)":function(t){t.currentTarget.value=null},focus:function(t){t.currentTarget.setAttribute("focused",!0)},"blur:delegate(.x-datepicker-input)":function(t){t.currentTarget.removeAttribute("focused")},"blur:delegate(.x-datepicker-polyfill-input)":function(t){var e=t.currentTarget;e.removeAttribute("focused"),f(e,function(){d(e,!0)},!0)},"touchstart:delegate(.x-datepicker-polyfill-input)":function(){this.setAttribute("readonly",!0)},"tapstart:delegate(x-calendar)":function(t){t.preventDefault(),t.baseEvent&&t.baseEvent.preventDefault()},"keypress:delegate(.x-datepicker-polyfill-input)":function(t){var e=t.keyCode,n=t.currentTarget;e===p&&f(n,function(){d(n,!0)},!0)},"input:delegate(.x-datepicker-input)":function(t){var e=t.currentTarget;f(e,function(){d(e,!0),t.stopPropagation(),xtag.fireEvent(e,"input")})},"input:delegate(.x-datepicker-polyfill-input)":function(t){var e=t.currentTarget;f(e,function(){d(e,!1),t.stopPropagation(),xtag.fireEvent(e,"input")})},"change:delegate(.x-datepicker-input)":function(t){t.stopPropagation(),xtag.fireEvent(t.currentTarget,"change")},"change:delegate(.x-datepicker-polyfill-input)":function(t){t.stopPropagation();var e=t.currentTarget;f(e,function(){d(e,!1)})}},accessors:{name:{attribute:{selector:".x-datepicker-input"},set:function(t){var e=this.xtag.dateInput;null===t||void 0===t?e.removeAttribute("name"):e.setAttribute("name",t)}},submitValue:{get:function(){return this.xtag.dateInput.value}},value:{attribute:{skip:!0},get:function(){return this.polyfill?this.xtag.polyfillInput.value:this.xtag.dateInput.value},set:function(t){var e=l(t),n=e?s(e):null,r=this.xtag.dateInput,i=this.xtag.polyfillInput,a=this.xtag.polyfillUI;if(null===t||void 0===t)this.removeAttribute("value"),r.value="",i&&(i.value=""),a&&(a.chosen=null);else{var o,u=n?n:t;i?t!==i.value?(i.value=u,o=u):o=t:o=u,this.setAttribute("value",o),n?(r.value=n,a&&(a.chosen=e,a.view=e)):(r.value="",a&&(a.chosen=null))}c(this)}},polyfill:{attribute:{"boolean":!0},set:function(t){var e=this.xtag.dateInput;if(t){if(e.setAttribute("type","hidden"),e.setAttribute("readonly",!0),!this.xtag.polyfillInput){var n=document.createElement("input");xtag.addClass(n,"x-datepicker-polyfill-input"),n.setAttribute("type","text"),n.setAttribute("placeholder",h(this)),n.value=this.xtag.dateInput.value,this.xtag.polyfillInput=n,this.appendChild(n)}if(this.xtag.polyfillInput.removeAttribute("disabled"),!this.xtag.polyfillUI){var r=document.createElement("x-calendar");xtag.addClass(r,"x-datepicker-polyfill-ui"),r.chosen=this.value,r.view=this.xtag.dateInput.value,r.controls=!0,r.labels=this.xtag._polyfillCalLabels,this.xtag.polyfillUI=r,this.appendChild(r)}}else{"date"!==e.getAttribute("type")&&e.setAttribute("type","date"),e.removeAttribute("readonly");var i=this.xtag.polyfillInput;i&&i.setAttribute("disabled",!0)}}},labels:{get:function(){var e={},n=this.xtag._labels,r=this.xtag._polyfillCalLabels;for(var i in n)e[i]=n[i];for(var i in r)e[i]=r[i];return t(e)},set:function(t){var e=this.xtag.polyfillUI,n=this.xtag.polyfillInput;if(e)e.labels=t,this.xtag._polyfillCalLabels=e.labels;else{var r=this.xtag._polyfillCalLabels;for(var i in r)i in t&&(r[i]=t[i])}var a=this.xtag._labels;for(var i in a)i in t&&(a[i]=t[i]);n&&n.setAttribute("placeholder",h(this))}}}})}();